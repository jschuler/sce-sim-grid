"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getDefinitions = exports.getRows = exports.getColumns = exports.getColumnNames = exports.getDmnFilePath = void 0;

var getDmnFilePath = function getDmnFilePath(data) {
  var dmnFilePath = data.value.simulation.simulationDescriptor.dmnFilePath;
  return dmnFilePath;
};

exports.getDmnFilePath = getDmnFilePath;

var getColumnNames = function getColumnNames(data) {
  var columns = [];
  var factMapping = data.value.simulation.simulationDescriptor.factMappings.factMapping;
  factMapping.forEach(function (col) {
    var name = col.expressionAlias || '';
    var group = col.factAlias || '';
    columns.push({
      name: name,
      group: group
    });
  });
  return columns;
};

exports.getColumnNames = getColumnNames;

var getColumns = function getColumns(data) {
  var byGroup = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
  var columnDefsOther = [];
  var columnDefsGiven = [];
  var columnDefsExpect = [];
  var numOther = 0;
  var numGiven = 0;
  var numExpect = 0;
  var fieldIndices = {};
  var factMapping = data.value.simulation.simulationDescriptor.factMappings.factMapping;
  factMapping.forEach(function (col, index) {
    var type = col.expressionIdentifier.type; // OTHER | GIVEN | EXPECT

    var field = col.expressionIdentifier.name; // this relates the column to the row cell

    fieldIndices[field] = index;

    if (type === "OTHER") {
      numOther = numOther + 1;
      var name = col.factAlias;
      columnDefsOther.push({
        name: name,
        field: field
      });
    } else {
      var _name = col.expressionAlias;
      var group = col.factAlias;

      if (!byGroup) {
        if (type === "GIVEN") {
          numGiven = numGiven + 1;
          columnDefsGiven.push({
            name: _name,
            field: field,
            group: group
          });
        } else {
          // EXPECT
          numExpect = numExpect + 1;
          columnDefsExpect.push({
            name: _name,
            field: field,
            group: group
          });
        }
      } else {
        if (type === "GIVEN") {
          numGiven = numGiven + 1; // check if the group already exists, if so push to it, otherwise create a new group

          if (columnDefsGiven.length === 0 || columnDefsGiven[columnDefsGiven.length - 1].group !== group) {
            // new group
            columnDefsGiven.push({
              group: group,
              children: [{
                name: _name,
                field: field
              }]
            });
          } else {
            // push to last group
            columnDefsGiven[columnDefsGiven.length - 1].children.push({
              name: _name,
              field: field
            });
          }
        } else {
          // EXPECT
          numExpect = numExpect + 1; // check if the group already exists, if so push to it, otherwise create a new group

          if (columnDefsExpect.length === 0 || columnDefsExpect[columnDefsExpect.length - 1].group !== group) {
            // new group
            columnDefsExpect.push({
              group: group,
              children: [{
                name: _name,
                field: field
              }]
            });
          } else {
            // push to last group
            columnDefsExpect[columnDefsExpect.length - 1].children.push({
              name: _name,
              field: field
            });
          }
        }
      }
    }
  });
  return {
    fieldIndices: fieldIndices,
    other: columnDefsOther,
    given: columnDefsGiven,
    expect: columnDefsExpect,
    numOther: numOther,
    numGiven: numGiven,
    numExpect: numExpect
  };
};

exports.getColumns = getColumns;

var getRows = function getRows(data, columns) {
  // construct the path so we can save back to the same location in the json file
  var dataPathRoot = 'value.simulation.scenarios.scenario';
  var rows = [];
  var scenario = data.value.simulation.scenarios.scenario;
  scenario.forEach(function (dataRow, index) {
    var dataPath = "".concat(dataPathRoot, "[").concat(index, "].factMappingValues.factMappingValue");
    var totalColumnsLength = columns.numOther + columns.numGiven + columns.numExpect;
    var hasExpressionIdentifierName = true; // create the row with a predetermined length so we can insert the cell in the correct column order

    var row = Array.from(Array(totalColumnsLength).keys());
    var entries = dataRow.factMappingValues.factMappingValue;
    entries.forEach(function (col, index) {
      var name = col.expressionIdentifier.name;
      var path = "".concat(dataPath, "[").concat(index, "].rawValue.value");

      if (!col.rawValue) {
        if (name) {
          row[columns.fieldIndices[name]] = {
            value: null,
            path: path
          };
        } else {
          hasExpressionIdentifierName = false;
          row[index] = {
            value: null,
            path: path
          };
        }
      } else {
        var value = col.rawValue.value;

        if (name) {
          row[columns.fieldIndices[name]] = {
            value: value,
            path: path
          };
        } else {
          hasExpressionIdentifierName = false;
          row[index] = {
            value: value,
            path: path
          };
        }
      }
    });

    if (!hasExpressionIdentifierName && row.length) {
      // this might be a workaround, but one of the scesim datasets did not have expressionIdentifier.name for the simulations
      // and for some reason the last item is the index, it should be at the front
      if (row.length) {
        row.unshift(row.pop());
      }
    }

    rows.push(row);
  });
  return rows;
};

exports.getRows = getRows;

var getDefinitions = function getDefinitions(data) {
  var definitions = {};
  var title = data.value.name;
  var itemDefinition = data.value.itemDefinition;
  itemDefinition.forEach(function (def) {
    // let definitionName = def.name.substring(1);
    var definitionTypes = {};
    var itemComponent = def.itemComponent;
    itemComponent.forEach(function (type) {
      if (type.allowedValues) {
        // enumeration
        definitionTypes[type.name] = type.allowedValues.text;
      } else {
        definitionTypes[type.name] = type.typeRef;
      }
    });
    definitions[def.name] = definitionTypes;
  });
  var drgElement = data.value.drgElement;
  var typeDefinitions = {
    '_title': title,
    simple: [],
    complex: [],
    map: {}
  };
  drgElement.forEach(function (element) {
    var type = element.name.localPart; // inputData | decision

    var text = element.value.name;
    var question = element.value.question;
    var choices = element.value.allowedAnswers || null;
    var typeRef = element.value.variable.typeRef; // e.g. tViolation, tFine, tDriver, string

    typeDefinitions[typeRef.charAt(0) === 't' ? 'complex' : 'simple'].push({
      typeRef: typeRef,
      type: type,
      text: text,
      choices: choices,
      question: question,
      elements: definitions[typeRef] || {
        value: choices
      }
    });
    typeDefinitions.map[text] = definitions[typeRef] || {
      value: choices
    };
  });
  return typeDefinitions;
};

exports.getDefinitions = getDefinitions;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9FZGl0b3JDb250YWluZXIvc2Nlc2ltVXRpbHMudHMiXSwibmFtZXMiOlsiZ2V0RG1uRmlsZVBhdGgiLCJkYXRhIiwiZG1uRmlsZVBhdGgiLCJ2YWx1ZSIsInNpbXVsYXRpb24iLCJzaW11bGF0aW9uRGVzY3JpcHRvciIsImdldENvbHVtbk5hbWVzIiwiY29sdW1ucyIsImZhY3RNYXBwaW5nIiwiZmFjdE1hcHBpbmdzIiwiZm9yRWFjaCIsImNvbCIsIm5hbWUiLCJleHByZXNzaW9uQWxpYXMiLCJncm91cCIsImZhY3RBbGlhcyIsInB1c2giLCJnZXRDb2x1bW5zIiwiYnlHcm91cCIsImNvbHVtbkRlZnNPdGhlciIsImNvbHVtbkRlZnNHaXZlbiIsImNvbHVtbkRlZnNFeHBlY3QiLCJudW1PdGhlciIsIm51bUdpdmVuIiwibnVtRXhwZWN0IiwiZmllbGRJbmRpY2VzIiwiaW5kZXgiLCJ0eXBlIiwiZXhwcmVzc2lvbklkZW50aWZpZXIiLCJmaWVsZCIsImxlbmd0aCIsImNoaWxkcmVuIiwib3RoZXIiLCJnaXZlbiIsImV4cGVjdCIsImdldFJvd3MiLCJkYXRhUGF0aFJvb3QiLCJyb3dzIiwic2NlbmFyaW8iLCJzY2VuYXJpb3MiLCJkYXRhUm93IiwiZGF0YVBhdGgiLCJ0b3RhbENvbHVtbnNMZW5ndGgiLCJoYXNFeHByZXNzaW9uSWRlbnRpZmllck5hbWUiLCJyb3ciLCJBcnJheSIsImZyb20iLCJrZXlzIiwiZW50cmllcyIsImZhY3RNYXBwaW5nVmFsdWVzIiwiZmFjdE1hcHBpbmdWYWx1ZSIsInBhdGgiLCJyYXdWYWx1ZSIsInVuc2hpZnQiLCJwb3AiLCJnZXREZWZpbml0aW9ucyIsImRlZmluaXRpb25zIiwidGl0bGUiLCJpdGVtRGVmaW5pdGlvbiIsImRlZiIsImRlZmluaXRpb25UeXBlcyIsIml0ZW1Db21wb25lbnQiLCJhbGxvd2VkVmFsdWVzIiwidGV4dCIsInR5cGVSZWYiLCJkcmdFbGVtZW50IiwidHlwZURlZmluaXRpb25zIiwic2ltcGxlIiwiY29tcGxleCIsIm1hcCIsImVsZW1lbnQiLCJsb2NhbFBhcnQiLCJxdWVzdGlvbiIsImNob2ljZXMiLCJhbGxvd2VkQW5zd2VycyIsInZhcmlhYmxlIiwiY2hhckF0IiwiZWxlbWVudHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFFTyxJQUFNQSxjQUFjLEdBQUcsU0FBakJBLGNBQWlCLENBQUNDLElBQUQsRUFBMEI7QUFBQSxNQUVwREMsV0FGb0QsR0FHbERELElBQUksQ0FBQ0UsS0FBTCxDQUFXQyxVQUFYLENBQXNCQyxvQkFINEIsQ0FFcERILFdBRm9EO0FBSXRELFNBQU9BLFdBQVA7QUFDRCxDQUxNOzs7O0FBT0EsSUFBTUksY0FBYyxHQUFHLFNBQWpCQSxjQUFpQixDQUFDTCxJQUFELEVBQWtCO0FBQzlDLE1BQUlNLE9BQWMsR0FBRyxFQUFyQjtBQUQ4QyxNQUc1Q0MsV0FINEMsR0FJMUNQLElBQUksQ0FBQ0UsS0FBTCxDQUFXQyxVQUFYLENBQXNCQyxvQkFBdEIsQ0FBMkNJLFlBSkQsQ0FHNUNELFdBSDRDO0FBSzlDQSxFQUFBQSxXQUFXLENBQUNFLE9BQVosQ0FDRSxVQUFDQyxHQUFELEVBQXNCO0FBQ3BCLFFBQUlDLElBQUksR0FBR0QsR0FBRyxDQUFDRSxlQUFKLElBQXVCLEVBQWxDO0FBQ0EsUUFBSUMsS0FBSyxHQUFHSCxHQUFHLENBQUNJLFNBQUosSUFBaUIsRUFBN0I7QUFDQVIsSUFBQUEsT0FBTyxDQUFDUyxJQUFSLENBQWE7QUFDWEosTUFBQUEsSUFBSSxFQUFKQSxJQURXO0FBRVhFLE1BQUFBLEtBQUssRUFBTEE7QUFGVyxLQUFiO0FBSUQsR0FSSDtBQVVBLFNBQU9QLE9BQVA7QUFDRCxDQWhCTTs7OztBQW9CQSxJQUFNVSxVQUFVLEdBQUcsU0FBYkEsVUFBYSxDQUFDaEIsSUFBRCxFQUE0QztBQUFBLE1BQTdCaUIsT0FBNkIsdUVBQVYsS0FBVTtBQUNwRSxNQUFJQyxlQUF1QixHQUFHLEVBQTlCO0FBQ0EsTUFBSUMsZUFBdUIsR0FB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QjtBQUNBLFFBQU00RCxRQUFRLEdBQUdGLE9BQU8sQ0FBQ25FLEtBQVIsQ0FBY3FFLFFBQS9CO0FBQ0EsUUFBTUMsT0FBTyxHQUFHSCxPQUFPLENBQUNuRSxLQUFSLENBQWN1RSxjQUFkLElBQWdDLElBQWhEO0FBQ0EsUUFBTVYsT0FBTyxHQUFHTSxPQUFPLENBQUNuRSxLQUFSLENBQWN3RSxRQUFkLENBQXVCWCxPQUF2QyxDQUxtQyxDQUthOztBQUNoREUsSUFBQUEsZUFBZSxDQUFDRixPQUFPLENBQUNZLE1BQVIsQ0FBZSxDQUFmLE1BQXNCLEdBQXRCLEdBQTRCLFNBQTVCLEdBQXdDLFFBQXpDLENBQWYsQ0FBa0U1RCxJQUFsRSxDQUNFO0FBQ0VnRCxNQUFBQSxPQUFPLEVBQVBBLE9BREY7QUFFRXJDLE1BQUFBLElBQUksRUFBSkEsSUFGRjtBQUdFb0MsTUFBQUEsSUFBSSxFQUFKQSxJQUhGO0FBSUVVLE1BQUFBLE9BQU8sRUFBUEEsT0FKRjtBQUtFRCxNQUFBQSxRQUFRLEVBQVJBLFFBTEY7QUFNRUssTUFBQUEsUUFBUSxFQUFFckIsV0FBVyxDQUFDUSxPQUFELENBQVgsSUFBd0I7QUFDaEM3RCxRQUFBQSxLQUFLLEVBQUVzRTtBQUR5QjtBQU5wQyxLQURGO0FBWUFQLElBQUFBLGVBQWUsQ0FBQ0csR0FBaEIsQ0FBb0JOLElBQXBCLElBQTRCUCxXQUFXLENBQUNRLE9BQUQsQ0FBWCxJQUF3QjtBQUNsRDdELE1BQUFBLEtBQUssRUFBRXNFO0FBRDJDLEtBQXBEO0FBR0QsR0FyQkQ7QUFzQkEsU0FBT1AsZUFBUDtBQUNELENBakRNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2Nlc2ltLCBGYWN0TWFwcGluZyB9IGZyb20gJy4uLy4uL3R5cGVzL1NjZVNpbSc7XG5cbmV4cG9ydCBjb25zdCBnZXREbW5GaWxlUGF0aCA9IChkYXRhOiBTY2VzaW0pOiBzdHJpbmcgPT4ge1xuICBjb25zdCB7XG4gICAgZG1uRmlsZVBhdGhcbiAgfSA9IGRhdGEudmFsdWUuc2ltdWxhdGlvbi5zaW11bGF0aW9uRGVzY3JpcHRvcjtcbiAgcmV0dXJuIGRtbkZpbGVQYXRoO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldENvbHVtbk5hbWVzID0gKGRhdGE6IFNjZXNpbSkgPT4ge1xuICBsZXQgY29sdW1uczogYW55W10gPSBbXTtcbiAgY29uc3Qge1xuICAgIGZhY3RNYXBwaW5nXG4gIH0gPSBkYXRhLnZhbHVlLnNpbXVsYXRpb24uc2ltdWxhdGlvbkRlc2NyaXB0b3IuZmFjdE1hcHBpbmdzO1xuICBmYWN0TWFwcGluZy5mb3JFYWNoKFxuICAgIChjb2w6IEZhY3RNYXBwaW5nKSA9PiB7XG4gICAgICBsZXQgbmFtZSA9IGNvbC5leHByZXNzaW9uQWxpYXMgfHwgJyc7XG4gICAgICBsZXQgZ3JvdXAgPSBjb2wuZmFjdEFsaWFzIHx8ICcnO1xuICAgICAgY29sdW1ucy5wdXNoKHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgZ3JvdXBcbiAgICAgIH0pO1xuICAgIH1cbiAgKTtcbiAgcmV0dXJuIGNvbHVtbnM7XG59O1xuXG50eXBlIENvbHVtbiA9IEFycmF5PCh7IG5hbWU/OiBzdHJpbmc7IGZpZWxkPzogc3RyaW5nOyBncm91cD86IHN0cmluZzsgY2hpbGRyZW4/OiB7IG5hbWU/OiBzdHJpbmc7IGZpZWxkPzogc3RyaW5nOyB9W107IH0pPjtcblxuZXhwb3J0IGNvbnN0IGdldENvbHVtbnMgPSAoZGF0YTogU2Nlc2ltLCBieUdyb3VwOiBib29sZWFuID0gZmFsc2UpID0+IHtcbiAgbGV0IGNvbHVtbkRlZnNPdGhlcjogQ29sdW1uID0gW107XG4gIGxldCBjb2x1bW5EZWZzR2l2ZW46IENvbHVtbiA9IFtdO1xuICBsZXQgY29sdW1uRGVmc0V4cGVjdDogQ29sdW1uID0gW107XG4gIGxldCBudW1PdGhlcjogbnVtYmVyID0gMDtcbiAgbGV0IG51bUdpdmVuOiBudW1iZXIgPSAwO1xuICBsZXQgbnVtRXhwZWN0OiBudW1iZXIgPSAwO1xuICBsZXQgZmllbGRJbmRpY2VzOiBhbnkgPSB7fTtcbiAgY29uc3Qge1xuICAgIGZhY3RNYXBwaW5nXG4gIH0gPSBkYXRhLnZhbHVlLnNpbXVsYXRpb24uc2ltdWxhdGlvbkRlc2NyaXB0b3IuZmFjdE1hcHBpbmdzO1xuICBmYWN0TWFwcGluZy5mb3JFYWNoKFxuICAgIChjb2w6IEZhY3RNYXBwaW5nLCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCB0eXBlID0gY29sLmV4cHJlc3Npb25JZGVudGlmaWVyLnR5cGU7IC8vIE9USEVSIHwgR0lWRU4gfCBFWFBFQ1RcbiAgICAgIGNvbnN0IGZpZWxkID0gY29sLmV4cHJlc3Npb25JZGVudGlmaWVyLm5hbWU7IC8vIHRoaXMgcmVsYXRlcyB0aGUgY29sdW1uIHRvIHRoZSByb3cgY2VsbFxuICAgICAgZmllbGRJbmRpY2VzW2ZpZWxkXSA9IGluZGV4O1xuICAgICAgaWYgKHR5cGUgPT09IFwiT1RIRVJcIikge1xuICAgICAgICBudW1PdGhlciA9IG51bU90aGVyICsgMTtcbiAgICAgICAgY29uc3QgbmFtZSA9IGNvbC5mYWN0QWxpYXM7XG4gICAgICAgIGNvbHVtbkRlZnNPdGhlci5wdXNoKHsgbmFtZSwgZmllbGQgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBuYW1lID0gY29sLmV4cHJlc3Npb25BbGlhcztcbiAgICAgICAgY29uc3QgZ3JvdXAgPSBjb2wuZmFjdEFsaWFzO1xuICAgICAgICBpZiAoIWJ5R3JvdXApIHtcbiAgICAgICAgICBpZiAodHlwZSA9PT0gXCJHSVZFTlwiKSB7XG4gICAgICAgICAgICBudW1HaXZlbiA9IG51bUdpdmVuICsgMTtcbiAgICAgICAgICAgIGNvbHVtbkRlZnNHaXZlbi5wdXNoKHsgbmFtZSwgZmllbGQsIGdyb3VwIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBFWFBFQ1RcbiAgICAgICAgICAgIG51bUV4cGVjdCA9IG51bUV4cGVjdCArIDE7XG4gICAgICAgICAgICBjb2x1bW5EZWZzRXhwZWN0LnB1c2goeyBuYW1lLCBmaWVsZCwgZ3JvdXAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmICh0eXBlID09PSBcIkdJVkVOXCIpIHtcbiAgICAgICAgICAgIG51bUdpdmVuID0gbnVtR2l2ZW4gKyAxO1xuICAgICAgICAgICAgLy8gY2hlY2sgaWYgdGhlIGdyb3VwIGFscmVhZHkgZXhpc3RzLCBpZiBzbyBwdXNoIHRvIGl0LCBvdGhlcndpc2UgY3JlYXRlIGEgbmV3IGdyb3VwXG4gICAgICAgICAgICBpZiAoY29sdW1uRGVmc0dpdmVuLmxlbmd0aCA9PT0gMCB8fCBjb2x1bW5EZWZzR2l2ZW5bY29sdW1uRGVmc0dpdmVuLmxlbmd0aCAtIDFdLmdyb3VwICE9PSBncm91cCkge1xuICAgICAgICAgICAgICAvLyBuZXcgZ3JvdXBcbiAgICAgICAgICAgICAgY29sdW1uRGVmc0dpdmVuLnB1c2goeyBncm91cCwgY2hpbGRyZW46IFt7IG5hbWUsIGZpZWxkIH1dIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gcHVzaCB0byBsYXN0IGdyb3VwXG4gICAgICAgICAgICAgIGNvbHVtbkRlZnNHaXZlbltjb2x1bW5EZWZzR2l2ZW4ubGVuZ3RoIC0gMV0uY2hpbGRyZW4hLnB1c2goeyBuYW1lLCBmaWVsZCB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBFWFBFQ1RcbiAgICAgICAgICAgIG51bUV4cGVjdCA9IG51bUV4cGVjdCArIDE7XG4gICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgZ3JvdXAgYWxyZWFkeSBleGlzdHMsIGlmIHNvIHB1c2ggdG8gaXQsIG90aGVyd2lzZSBjcmVhdGUgYSBuZXcgZ3JvdXBcbiAgICAgICAgICAgIGlmIChjb2x1bW5EZWZzRXhwZWN0Lmxlbmd0aCA9PT0gMCB8fCBjb2x1bW5EZWZzRXhwZWN0W2NvbHVtbkRlZnNFeHBlY3QubGVuZ3RoIC0gMV0uZ3JvdXAgIT09IGdyb3VwKSB7XG4gICAgICAgICAgICAgIC8vIG5ldyBncm91cFxuICAgICAgICAgICAgICBjb2x1bW5EZWZzRXhwZWN0LnB1c2goeyBncm91cCwgY2hpbGRyZW46IFt7IG5hbWUsIGZpZWxkIH1dIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gcHVzaCB0byBsYXN0IGdyb3VwXG4gICAgICAgICAgICAgIGNvbHVtbkRlZnNFeHBlY3RbY29sdW1uRGVmc0V4cGVjdC5sZW5ndGggLSAxXS5jaGlsZHJlbiEucHVzaCh7IG5hbWUsIGZpZWxkIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICApO1xuICByZXR1cm4ge1xuICAgIGZpZWxkSW5kaWNlcyxcbiAgICBvdGhlcjogY29sdW1uRGVmc090aGVyLFxuICAgIGdpdmVuOiBjb2x1bW5EZWZzR2l2ZW4sXG4gICAgZXhwZWN0OiBjb2x1bW5EZWZzRXhwZWN0LFxuICAgIG51bU90aGVyLFxuICAgIG51bUdpdmVuLFxuICAgIG51bUV4cGVjdFxuICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IGdldFJvd3MgPSAoZGF0YTogU2Nlc2ltLCBjb2x1bW5zPzogYW55KSA9PiB7XG4gIC8vIGNvbnN0cnVjdCB0aGUgcGF0aCBzbyB3ZSBjYW4gc2F2ZSBiYWNrIHRvIHRoZSBzYW1lIGxvY2F0aW9uIGluIHRoZSBqc29uIGZpbGVcbiAgY29uc3QgZGF0YVBhdGhSb290OiBzdHJpbmcgPSAndmFsdWUuc2ltdWxhdGlvbi5zY2VuYXJpb3Muc2NlbmFyaW8nO1xuICBjb25zdCByb3dzOiBhbnlbXSA9IFtdO1xuICBjb25zdCB7IHNjZW5hcmlvIH0gPSBkYXRhLnZhbHVlLnNpbXVsYXRpb24uc2NlbmFyaW9zO1xuICBzY2VuYXJpby5mb3JFYWNoKFxuICAgIChkYXRhUm93OiB7IGZhY3RNYXBwaW5nVmFsdWVzOiB7IGZhY3RNYXBwaW5nVmFsdWU6IGFueSB9IH0sIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFQYXRoID0gYCR7ZGF0YVBhdGhSb290fVske2luZGV4fV0uZmFjdE1hcHBpbmdWYWx1ZXMuZmFjdE1hcHBpbmdWYWx1ZWA7XG4gICAgICBjb25zdCB0b3RhbENvbHVtbnNMZW5ndGggPSBjb2x1bW5zLm51bU90aGVyICsgY29sdW1ucy5udW1HaXZlbiArIGNvbHVtbnMubnVtRXhwZWN0O1xuICAgICAgbGV0IGhhc0V4cHJlc3Npb25JZGVudGlmaWVyTmFtZSA9IHRydWU7XG4gICAgICAvLyBjcmVhdGUgdGhlIHJvdyB3aXRoIGEgcHJlZGV0ZXJtaW5lZCBsZW5ndGggc28gd2UgY2FuIGluc2VydCB0aGUgY2VsbCBpbiB0aGUgY29ycmVjdCBjb2x1bW4gb3JkZXJcbiAgICAgIGxldCByb3c6IGFueVtdID0gQXJyYXkuZnJvbShBcnJheSh0b3RhbENvbHVtbnNMZW5ndGgpLmtleXMoKSk7XG4gICAgICBjb25zdCBlbnRyaWVzID0gZGF0YVJvdy5mYWN0TWFwcGluZ1ZhbHVlcy5mYWN0TWFwcGluZ1ZhbHVlO1xuICAgICAgZW50cmllcy5mb3JFYWNoKChjb2w6IHsgcmF3VmFsdWU/OiB7IHZhbHVlOiBhbnkgfSwgZXhwcmVzc2lvbklkZW50aWZpZXI6IHsgbmFtZTogc3RyaW5nIH0gfSwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgICBjb25zdCB7IG5hbWUgfSA9IGNvbC5leHByZXNzaW9uSWRlbnRpZmllcjtcbiAgICAgICAgY29uc3QgcGF0aCA9IGAke2RhdGFQYXRofVske2luZGV4fV0ucmF3VmFsdWUudmFsdWVgO1xuICAgICAgICBpZiAoIWNvbC5yYXdWYWx1ZSkge1xuICAgICAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgICAgICByb3dbY29sdW1ucy5maWVsZEluZGljZXNbbmFtZV1dID0ge1xuICAgICAgICAgICAgICB2YWx1ZTogbnVsbCxcbiAgICAgICAgICAgICAgcGF0aFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaGFzRXhwcmVzc2lvbklkZW50aWZpZXJOYW1lID0gZmFsc2U7XG4gICAgICAgICAgICByb3dbaW5kZXhdID0ge1xuICAgICAgICAgICAgICB2YWx1ZTogbnVsbCxcbiAgICAgICAgICAgICAgcGF0aFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgeyB2YWx1ZSB9ID0gY29sLnJhd1ZhbHVlO1xuICAgICAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgICAgICByb3dbY29sdW1ucy5maWVsZEluZGljZXNbbmFtZV1dID0ge1xuICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgcGF0aFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaGFzRXhwcmVzc2lvbklkZW50aWZpZXJOYW1lID0gZmFsc2U7XG4gICAgICAgICAgICByb3dbaW5kZXhdID0ge1xuICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgcGF0aFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKCFoYXNFeHByZXNzaW9uSWRlbnRpZmllck5hbWUgJiYgcm93Lmxlbmd0aCkge1xuICAgICAgICAvLyB0aGlzIG1pZ2h0IGJlIGEgd29ya2Fyb3VuZCwgYnV0IG9uZSBvZiB0aGUgc2Nlc2ltIGRhdGFzZXRzIGRpZCBub3QgaGF2ZSBleHByZXNzaW9uSWRlbnRpZmllci5uYW1lIGZvciB0aGUgc2ltdWxhdGlvbnNcbiAgICAgICAgLy8gYW5kIGZvciBzb21lIHJlYXNvbiB0aGUgbGFzdCBpdGVtIGlzIHRoZSBpbmRleCwgaXQgc2hvdWxkIGJlIGF0IHRoZSBmcm9udFxuICAgICAgICBpZiAocm93Lmxlbmd0aCkge1xuICAgICAgICAgIHJvdy51bnNoaWZ0KHJvdy5wb3AoKSEpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJvd3MucHVzaChyb3cpO1xuICAgIH1cbiAgKTtcbiAgcmV0dXJuIHJvd3M7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0RGVmaW5pdGlvbnMgPSAoZGF0YTogeyB2YWx1ZTogeyBpdGVtRGVmaW5pdGlvbj86IGFueTsgZHJnRWxlbWVudD86IGFueTsgbmFtZT86IGFueTsgfTsgfSkgPT4ge1xuICBsZXQgZGVmaW5pdGlvbnM6IGFueSA9IHt9O1xuICBjb25zdCB0aXRsZSA9IGRhdGEudmFsdWUubmFtZTtcbiAgY29uc3QgeyBpdGVtRGVmaW5pdGlvbiB9ID0gZGF0YS52YWx1ZTtcbiAgaXRlbURlZmluaXRpb24uZm9yRWFjaCgoZGVmOiBhbnkpID0+IHtcbiAgICAvLyBsZXQgZGVmaW5pdGlvbk5hbWUgPSBkZWYubmFtZS5zdWJzdHJpbmcoMSk7XG4gICAgbGV0IGRlZmluaXRpb25UeXBlcyA9IHt9IGFzIGFueTtcbiAgICBjb25zdCB7IGl0ZW1Db21wb25lbnQgfSA9IGRlZjtcbiAgICBpdGVtQ29tcG9uZW50LmZvckVhY2goKHR5cGU6IHsgbmFtZTogYW55OyB0eXBlUmVmOiBhbnk7IGFsbG93ZWRWYWx1ZXM/OiBhbnkgfSkgPT4ge1xuICAgICAgaWYgKHR5cGUuYWxsb3dlZFZhbHVlcykge1xuICAgICAgICAvLyBlbnVtZXJhdGlvblxuICAgICAgICBkZWZpbml0aW9uVHlwZXNbdHlwZS5uYW1lXSA9IHR5cGUuYWxsb3dlZFZhbHVlcy50ZXh0O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGVmaW5pdGlvblR5cGVzW3R5cGUubmFtZV0gPSB0eXBlLnR5cGVSZWY7XG4gICAgICB9XG4gICAgfSk7XG4gICAgZGVmaW5pdGlvbnNbZGVmLm5hbWVdID0gZGVmaW5pdGlvblR5cGVzO1xuICB9KTtcblxuICBjb25zdCB7IGRyZ0VsZW1lbnQgfSA9IGRhdGEudmFsdWU7XG4gIGNvbnN0IHR5cGVEZWZpbml0aW9uczogYW55ID0ge1xuICAgICdfdGl0bGUnOiB0aXRsZSxcbiAgICBzaW1wbGU6IFtdLFxuICAgIGNvbXBsZXg6IFtdLFxuICAgIG1hcDoge31cbiAgfTtcbiAgZHJnRWxlbWVudC5mb3JFYWNoKChlbGVtZW50OiBhbnkpID0+IHtcbiAgICBjb25zdCB0eXBlID0gZWxlbWVudC5uYW1lLmxvY2FsUGFydDsgLy8gaW5wdXREYXRhIHwgZGVjaXNpb25cbiAgICBjb25zdCB0ZXh0ID0gZWxlbWVudC52YWx1ZS5uYW1lO1xuICAgIGNvbnN0IHF1ZXN0aW9uID0gZWxlbWVudC52YWx1ZS5xdWVzdGlvbjtcbiAgICBjb25zdCBjaG9pY2VzID0gZWxlbWVudC52YWx1ZS5hbGxvd2VkQW5zd2VycyB8fCBudWxsO1xuICAgIGNvbnN0IHR5cGVSZWYgPSBlbGVtZW50LnZhbHVlLnZhcmlhYmxlLnR5cGVSZWY7IC8vIGUuZy4gdFZpb2xhdGlvbiwgdEZpbmUsIHREcml2ZXIsIHN0cmluZ1xuICAgIHR5cGVEZWZpbml0aW9uc1t0eXBlUmVmLmNoYXJBdCgwKSA9PT0gJ3QnID8gJ2NvbXBsZXgnIDogJ3NpbXBsZSddLnB1c2goXG4gICAgICB7XG4gICAgICAgIHR5cGVSZWYsXG4gICAgICAgIHR5cGUsXG4gICAgICAgIHRleHQsXG4gICAgICAgIGNob2ljZXMsXG4gICAgICAgIHF1ZXN0aW9uLFxuICAgICAgICBlbGVtZW50czogZGVmaW5pdGlvbnNbdHlwZVJlZl0gfHwge1xuICAgICAgICAgIHZhbHVlOiBjaG9pY2VzXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICAgIHR5cGVEZWZpbml0aW9ucy5tYXBbdGV4dF0gPSBkZWZpbml0aW9uc1t0eXBlUmVmXSB8fCB7XG4gICAgICB2YWx1ZTogY2hvaWNlc1xuICAgIH07XG4gIH0pO1xuICByZXR1cm4gdHlwZURlZmluaXRpb25zO1xufVxuIl19